KISSY.add("gallery/uploader/1.4/plugins/preview/preview",function(d,i,m,g){function j(a,c){if(!a)return!1;"filter"!=f?a.src=c||l:c&&(c=c.replace(/[)'"%]/g,function(a){return escape(escape(a))}),a.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=c);return!0}function e(a){this.config=d.mix({maxWidth:40,maxHeight:40},a);e.superclass.constructor.call(this,a)}var k=document,f=function(){var a="";if("undefined"===typeof window.FileReader)switch(d.UA.shell){case "firefox":a="domfile";break;
case "ie":switch(d.UA.ie){case 6:a="simple";break;default:a="filter"}}else a="html5";return a}(),l=8>d.UA.ie?"http://a.tbcdn.cn/p/fp/2011a/assets/space.gif":"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";d.extend(e,g,{pluginInitializer:function(){},preview:function(a,c){var a=i.get(a),c=i.get(c),b=this,e=function(){b.fire(void 0,{data:b.data,mode:f});c&&(j(c,b.data),b.fire("showed",{img:c}))};b.data=void 0;if(a){d.log("[Plugin: Preview] One file selected. Getting data...");
switch(f){case "domfile":b.data=a.files[0].getAsDataURL();break;case "filter":a.select();try{b.data=k.selection.createRange().text}catch(g){d.log("[Plugin: Preview] Get image data error, the error is: "),d.log(g,"dir")}finally{k.selection.empty()}b.data||(b.data=a.value);break;case "html5":var h=new FileReader;h.onload=function(a){b.data=a.target.result;e()};h.onerror=function(){d.log("[Plugin: Preview] File Reader Error. Your browser may not fully support html5 file api","warning");b.fire("error")};
a.files&&h.readAsDataURL(a.files[0]);break;default:b.data=a.value}b.data?e():"html5"!=f&&(d.log("[Plugin: Preview] Retrive Data error."),j(c),b.fire("error"))}else d.log("[Plugin: Preview] File Input Element does not exists.");return b.data}},{ATTRS:{pluginId:{value:"preview"}}});return e},{requires:["dom","event","base"]});
