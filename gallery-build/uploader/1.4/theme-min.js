KISSY.add("gallery/uploader/1.4/theme",function(d,h,i){function f(a){f.superclass.constructor.call(this,a)}var e=h.all;d.extend(f,i,{render:function(){this._addThemeCssName();this._tplFormHtml();this._bind()},_selectHandler:function(){},_addHandler:function(){},_removeHandler:function(){},_waitingHandler:function(){},_startHandler:function(){},_progressHandler:function(){},_successHandler:function(){},_errorHandler:function(){},_restore:function(){var a=this,b=a.get("uploader"),c=b.getPlugin("urlsInput");
if(!c||!c.get("autoRestore"))return!1;c=b.get("queue").get("files");if(!c.length)return!1;d.each(c,function(c,d){c.status="success";b.fire("add",{file:c,index:d});a._renderHandler("_successHandler",{file:c,result:c.result});a._hideStatusDiv(c)});return a},_addThemeCssName:function(){var a=this.get("name"),b=this.get("queueTarget"),c=this.get("uploader").get("target");if(!b.length)return d.log("\u4e0d\u5b58\u5728\u5bb9\u5668\u76ee\u6807\uff01"),!1;if(""==a)return!1;b.length&&b.addClass("ks-uploader-queue "+a+"-queue");c.addClass(a+"-button");
return this},_bind:function(){var a=this,b=a.get("uploader"),c="add,remove,select,start,progress,success,error,complete".split(",");b.on(c[0],function(c){var d=a._appendFileDom(c.file);b.get("queue").updateFile(c.index,{target:d})});b.on(c[1],function(b){a._removeFileDom(b.file)});var g=!1;b.on(c[0],function(){g||(a._setAuth(),g=!0)});d.each(c,function(c){b.on(c,function(b){a._renderHandler("_"+b.type+"Handler",b)})})},_renderHandler:function(a,b){var c=this[a];this._setStatusVisibility(b.file);c&&
c.call(this,b)},_setStatusVisibility:function(a){if(!d.isObject(a))return this;this._hideStatusDiv(a);var b=a.status,c=a.target;if(!c.length)return!1;a=c.all("."+b+"-status");a.length&&a.show();d.each("waiting,start,uploading,progress,error,success".split(","),function(a){c.removeClass(a)});c.addClass(b);return this},_hideStatusDiv:function(a){if(!d.isObject(a))return!1;a=a.target;a.length&&a.all(".status").hide()},_appendFileDom:function(a){var b=this.get("fileTpl"),c=e(this.get("queueTarget"));
if(!c.length)return!1;b=d.substitute(b,a);return e(b).hide().appendTo(c).fadeIn(0.4).data("data-file",a)},_removeFileDom:function(a){if(!d.isObject(a))return!1;var b=a.target;if(!b||!b.length)return!1;b.fadeOut(0.4,function(){b.remove()})},_tplFormHtml:function(){var a=this,b=a.get("fileTpl"),c=e(a.get("queueTarget"));if(!c.length)return!1;c.all("script").each(function(c){"text/uploader-theme"==c.attr("type")&&(b=c.html(),a.set("fileTpl",b))});return b},_setAuth:function(){var a=this.get("uploader").getPlugin("auth");
if(!a)return!1;var b=this.get("allowExts");""==a.get("allowExts")&&""!==b&&a.set("allowExts",b);b=this.get("authMsg");if(d.isEmptyObject(b))return!1;a.set("msg",b)}},{ATTRS:{name:{value:""},use:{value:""},fileTpl:{value:""},authMsg:{value:{}},queueTarget:{value:"",getter:function(a){return e(a)}},queue:{value:""},uploader:{value:""}}});return f},{requires:["node","base"]});
