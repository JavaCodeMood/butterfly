KISSY.add("gallery/form/1.3/uploader/themes/loveUploader/index",function(g,i,j){function h(a){h.superclass.constructor.call(this,a)}var d=i.all;g.extend(h,j,{afterUploaderRender:function(){var a=this.get("queue");this._renderFiledrop();a.on("add",this._addFileHandler,this)},_addFileHandler:function(a){var a=a.file,c=a.target,b=d(".J_Del_"+a.id),e=d(".J_Mask_"+a.id);c.on("mouseover mouseout",function(a){"mouseover"==a.type?(b.show(),e.show()):(b.hide(),e.hide())});b.data("data-file",a);b.on("click",
this._delHandler,this)},_getStatusWrapper:function(a){return a&&a.children(".J_FileStatus")||d("")},_renderFiledrop:function(){var a=this.get("button").get("target"),c=this.get("oPlugin").filedrop;if(!c)return!1;a=new c({target:a,uploader:this.get("uploader"),tpl:{supportDrop:'<div class="drop-wrapper"></div>'}});a.render();return a},_waitingHandler:function(){},_startHandler:function(a){var c=this,b=a.uploader,e=a.index,g=c.get("queue"),b=b.get("type"),a=d(".J_ProgressBar_"+a.id);if("ajax"==b||"flash"==
b){var b=c.get("oPlugin").progressBar,f;b&&(f=new b(a),f.on("change",function(a){100==a.value&&(f.hide(),c._setDisplayMsg(!1,a.file))}),f.render(),c.set("progressBar",f));g.updateFile(e,{progressBar:f})}},_progressHandler:function(a){var c=a.file,a=Math.ceil(100*(a.loaded/a.total)),c=c.progressBar;if(!c)return!1;c.set("value",a)},_successHandler:function(a){var c=a.file,b=c.id,e=c.result,c=c.progressBar;this._setCount();e&&this._changeImageSrc(a.id,e);if(!c)return d(".J_ProgressBar_"+b).hide(),this._setDisplayMsg(!1,
a.file),!1;c.set("value",100);d(".J_Mask_"+b).hide()},_errorHandler:function(a){var c=a.msg;d(".J_ErrorMsg_"+a.id).html(c);this._setDisplayMsg(!0,a.file);g.log(c)},_setCount:function(){var a=d(this.get("elCount")),c=this.getFilesLen(),b=this.get("auth");if(!b)return!1;b=b.get("rules").max;if(!b)return!1;a.length&&a.text(b[0]-c)},_setDisplayMsg:function(a,c){if(!c)return!1;var b=d(".J_Mask_"+c.id);b[a&&"show"||"hide"]();a?b.show():b.hide()},_delHandler:function(a){var c=this.get("uploader"),b=this.get("queue"),
a=d(a.target).data("data-file"),b=b.getFileIndex(a.id),a=a.status;("start"==a||"progress"==a)&&c.cancel(b);this._setCount()},getFilesLen:function(a){a||(a="success");return this.get("queue").getFiles(a).length},_changeImageSrc:function(a,c){var b=c.data,e=d(".J_Pic_"+a);if(!g.isObject(b))return!1;b=b.url;""==e.attr("src")&&(e.show(),e.attr("src",b))}},{ATTRS:{name:{value:"loveUploader"},cssUrl:{value:"gallery/form/1.3/uploader/themes/loveUploader/style.css"},fileTpl:{value:'<li id="queue-file-{id}" class="clearfix" data-name="{name}"><div class="tb-pic120"><a href="javascript:void(0);"><img class="J_Pic_{id}" src="" /></a></div><div class=" J_Mask_{id} pic-mask"></div><div class="status-wrapper J_FileStatus"><div class="status waiting-status tips-upload-waiting"><p class="tips-text">\u7b49\u5f85\u4e0a\u4f20\uff0c\u8bf7\u7a0d\u5019</p></div><div class="status start-status progress-status success-status tips-uploading"><div class="J_ProgressBar_{id}"><s class="loading-icon"></s>\u4e0a\u4f20\u4e2d...</div></div><div class="status error-status tips-upload-error"><p class="J_ErrorMsg_{id} tips-text">\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01</p></div></div><a class="J_Del_{id} del-pic" href="#">\u5220\u9664</a></li>'},
plugins:{value:["progressBar","filedrop"]},elCount:{value:"#J_UploadCount"},isMaxHideBtn:{value:!0}}});return h},{requires:["node","../../theme"]});
