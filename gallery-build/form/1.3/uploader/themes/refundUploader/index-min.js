KISSY.add(function(f,j,k){function g(a){g.superclass.constructor.call(this,a)}var d=j.all;f.extend(g,k,{afterUploaderRender:function(){var a=this,b=a.get("queue");b.on("add",a._addFileHandler,a);b.on("remove",function(){a._changeText()});b=a.get("button");b=d(b.get("target")).text();a.set("defaultText",b)},_addFileHandler:function(a){var a=a.file,b=d(".J_Del_"+a.id);b.data("data-file",a);b.on("click",this._delHandler,this)},_getStatusWrapper:function(a){return a&&a.all(".J_FileStatus")||d("")},_waitingHandler:function(a){if("ajax"==
a.uploader.get("type")){var b=this.get("oPlugin").preview,a=a.file,c=d(".J_Pic_"+a.id);c.show();(new b).show(a.data,c)}},_startHandler:function(a){var b=this,c=a.uploader,e=a.index,l=b.get("queue"),g=c.get("type"),i=a.file,c=d(".J_ProgressBar_"+a.id);d(".J_Mask_"+a.id).show();if("ajax"==g||"flash"==g){var a=b.get("oPlugin").progressBar,h;a&&(h=new a(c),h.on("change",function(a){100==a.value&&f.later(function(){h.hide();b._setDisplayMask(!1,i);i.statusWrapper.hide()},500)}),h.render(),b.set("progressBar",
h));l.updateFile(e,{progressBar:h})}},_progressHandler:function(a){var b=a.file,a=Math.ceil(100*(a.loaded/a.total)),b=b.progressBar;if(!b)return!1;b.set("value",a)},_successHandler:function(a){var b=a.file,c=b.id,e=b.result,f=b.progressBar;e&&this._changeImageSrc(a.id,e);this._changeText();if(!f)return d(".J_ProgressBar_"+c).hide(),this._setDisplayMask(!1,a.file),b.statusWrapper.hide(),!1;f.set("value",100)},_errorHandler:function(a){var b=a.msg,c=a.id,e=this.get("queue");f.log(b);if("max"==a.rule||
"required"==a.rule)return!1;d(".J_ErrorMsg_"+c).html("\u4e0a\u4f20\u5931\u8d25");f.later(function(){alert(b);e.remove(c)},1E3)},_setDisplayMask:function(a,b){if(!b)return!1;var c=d(".J_Mask_"+b.id);c[a&&"show"||"hide"]();a?c.show():c.hide()},_delHandler:function(a){var b=this.get("uploader"),c=this.get("queue"),a=d(a.target).data("data-file"),c=c.getFileIndex(a.id),a=a.status;("start"==a||"progress"==a)&&b.cancel(c)},getFilesLen:function(a){a||(a="success");return this.get("queue").getFiles(a).length},_changeImageSrc:function(a,
b){var c=b.data,e=d(".J_Pic_"+a);if(!f.isObject(c))return!1;c=c.sUrl||c.url;if(""==e.attr("src")||f.UA.safari)e.show(),e.attr("src",c)},_changeText:function(){var a=this.getFilesLen(),b=this.get("auth"),c=this.get("button").get("target").children("span"),e=this.get("maxText"),d=this.get("defaultText");if(!b)return!1;b=b.get("rules").max;if(!b)return!1;Number(b[0])<=a?c.text(f.substitute(e,{max:b[0]})):c.text(d)}},{ATTRS:{name:{value:"refundUploader"},cssUrl:{value:"gallery/form/1.3/uploader/themes/refundUploader/style.css"},
fileTpl:{value:'<li id="queue-file-{id}" class="g-u" data-name="{name}"><div class="pic-wrapper"><div class="pic"><span><img class="J_Pic_{id}" src="" /></span></div><div class=" J_Mask_{id} pic-mask"></div><div class="status-wrapper J_FileStatus"><div class="status waiting-status"><p>\u7b49\u5f85\u4e0a\u4f20</p></div><div class="status start-status progress-status success-status"><div class="J_ProgressBar_{id}"></div><div>\u4e0a\u4f20\u4e2d</div></div><div class="status error-status"><p class="J_ErrorMsg_{id}">\u4e0a\u4f20\u5931\u8d25\uff0c\u8bf7\u91cd\u8bd5\uff01</p></div></div></div><div><a class="J_Del_{id} del-pic" href="#">\u5220\u9664</a></div></li>'},
plugins:{value:["progressBar","preview"]},defaultText:{value:""},maxText:{value:"\u60a8\u5df2\u4e0a\u4f20\u6ee1{max}\u5f20\u56fe\u7247"}}});return g},{requires:["node","../../theme"]});
