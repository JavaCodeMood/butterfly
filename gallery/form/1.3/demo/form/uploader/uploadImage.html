<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>ImageUploader：图片上传组件</title>
    <link rel="shortcut icon" href="http://docs.kissyui.com/kissy-dpl/base/assets/favicon.ico"/>
    <link rel="stylesheet" type="text/css" href="../../assets/bootstrap.min.css"/>
    <link rel="stylesheet" type="text/css" href="../../assets/bootstrap-responsive.css"/>
    <link rel="stylesheet" type="text/css" href="../../assets/docs.css"/>
    <script src="http://a.tbcdn.cn/s/kissy/1.2.0/kissy-min.js" charset="utf-8"></script>
    <script src="../../assets/feedback.js" charset="utf-8"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" charset="utf-8"></script>
    <script src="../../assets/bootstrap.min.js" charset="utf-8"></script>
    <script src="../../assets/app.js" charset="utf-8"></script>
</head>
<body>
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo.html"
               id="logo">BUTTERFLY</a>

            <div class="nav-collapse">

                <ul class="nav">
                    <li><a href="http://docs.kissyui.com/kissy-gallery/gallery/form/1.2/demo.html">首页</a></li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">组件 <b
                            class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li><a href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/uploader/index.html">Uploader</a>
                            </li>
                            <li class=""><a
                                    href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/limiter/index.html">Limiter</a>
                            </li>
                            <li><a href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/spinbox/index.html">SpinBox</a>
                            </li>
                            <li>
                                <a href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/auth/index.html">Auth</a>
                            </li>
                            <li class=""><a
                                    href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/checkbox/index.html">checkbox</a>
                            </li>
                            <li class=""><a
                                    href="http://www.36ria.com/demo/gal/gallery/form/1.2/demo/form/radio/index.html">radio</a>
                            </li>
                        </ul>
                    </li>
                    <li><a href="https://github.com/kissyteam/kissy-gallery/tree/master/gallery/form">源码</a></li>
                    <li><a href="http://www.36ria.com/demo/gal/gallery/form/1.2/doc/index.html">API文档</a></li>
                </ul>
                <ul class="nav pull-right">
                    <li><a rel="tooltip" target="_blank" href="http://docs.kissyui.com/kissy-gallery/index.html">kissy
                        gallery</a></li>
                </ul>
            </div>
        </div>
    </div>
</div>
<header id="header" class="jumbotron subhead">
    <div class="header-content">
        <h1 class="title-h1">ImageUploader </h1>
        <p class="header-dec">图片上传组件</p>
    </div>
</header>
<div id="content" class="container">
    <div class="row">
        <div class="span3 bs-docs-sidebar">
            <ul class="nav nav-list bs-docs-sidenav">
                <li><a href="#imageUploaderDec"><i class="icon-chevron-right"></i>综述</a></li>
                <li><a href="#demos"><i class="icon-chevron-right"></i>demo汇总</a></li>
                <li><a href="#themes"><i class="icon-chevron-right"></i>组件内置的主题</a></li>
                <li><a href="#init"><i class="icon-chevron-right"></i>3种方式初始化组件</a></li>
                <li><a href="#auth"><i class="icon-chevron-right"></i> 上传验证控制</a></li>
                <li><a href="#modals"><i class="icon-chevron-right"></i> IE无法上传问题</a></li>
                <li><a href="#dropdowns"><i class="icon-chevron-right"></i>主题</a></li>
                <li><a href="#scrollspy"><i class="icon-chevron-right"></i>事件</a></li>
                <li><a href="#tabs"><i class="icon-chevron-right"></i> 属性</a></li>
                <li><a href="#tooltips"><i class="icon-chevron-right"></i>方法</a></li>
            </ul>
        </div>
        <div class="span9">
            <h2 id="imageUploaderDec">综述</h2>

            <p>ImageUploader继承于Uploader，用于解决Uploader过于复杂，调用不便的问题，ImageUploader专门用于图片上传，自带图片验证，改进了伪属性配置方式。</p>
            <div class="alert alert-info"><strong>PS:</strong> 如果是图片上传，不再建议使用Uploader，也不再建议用户自己设置type来控制上传方式。</div>

            <h4>ImageUploader的特性</h4>
            <ul>
                <li>支持ajax、flash、iframe三方案，兼容所有浏览器。（iframe不推荐使用）</li>
                <li>多主题支持，可以自己定制主题</li>
                <li>支持多选批量上传</li>
                <li>支持上传进度显示</li>
                <li>支持取消上传</li>
                <li>支持图片预览（使用flash上传不支持）</li>
                <li>支持上传验证</li>
                <li>多种配置方式</li>
            </ul>
            <h2 id="demos">demo汇总</h2>
            <ul class="thumbnails">
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                                简单demo：js配置上传组件
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            简单demo：属性配置上传组件
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            组件全部事件演示
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            上传验证控制
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            常用属性控制
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            常用方法控制
                        </div>
                    </a>
                </li>
            </ul>
            <h2 id="themes">ImageUploader内置的主题</h2>
            <ul class="thumbnails">
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            <h4>主题：imageUploader</h4>
                            <img alt="uploader" src="http://www.36ria.com/wp-content/uploads/2012/08/imageUploader.png">
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            <h4>主题：refundUploader</h4>
                            <img alt="uploader" src="http://www.36ria.com/wp-content/uploads/2012/08/refundUploader.png">
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            <h4>主题：loveUploader</h4>
                            <img alt="uploader" src="http://www.36ria.com/wp-content/uploads/2012/05/uploader.png">
                        </div>
                    </a>
                </li>
                <li class="span3">
                    <a href="" class="demo-item" target="_blank">
                        <div class="thumbnail">
                            <h4>主题：ershouUploader</h4>
                            <img alt="uploader" src="http://www.36ria.com/wp-content/uploads/2012/03/uploader-theme-3-400x138.png">
                        </div>
                    </a>
                </li>
            </ul>
            <h2 id="init">3种方式初始化组件</h2>

            <p>gallery的包配置是必不可少：</p>
            <pre class='brush: js; '>
KISSY.config({
    packages:[
        {
            name:"gallery",
            path:"http://a.tbcdn.cn/s/kissy/",
            charset:"utf-8"
        }
    ]
});
            </pre>
            <p></p>
            <h3>1.使用js配置初始化组件</h3>
            <div class="bs-docs-example">
                <form action="#" style="font-size:12px;">
                    <div class="grid">
                        <input type="image-uploader" class="g-u" id="J_JsUploaderBtn" name="Filedata" value="上传图片" >
                    </div>
                    <ul id="J_JsUploaderQueue" class="grid">

                    </ul>
                </form>
            </div>
            <pre class='brush: js; '>
new ImageUploader('#J_JsUploaderBtn','#J_JsUploaderQueue',{
    // 文件域
    name:"Filedata",
    //处理上传的服务器端脚本路径
    action:"upload.php",
    //用于放服务器端返回的url的隐藏域
    urlsInputName:"jsImageUrls"
}).render();
            </pre>
            <h3>2.使用标签属性配置初始化</h3>
            <div class="bs-docs-example">
                <form action="#" style="font-size:12px;">
                    <div class="grid">

                        <input class="g-u" id="J_UploaderBtn" name="Filedata" type="image-uploader" value="上传图片" queueTarget="#J_UploaderQueue"
                               action="upload.php" urlsInputName="imageUrls">

                        <!--用来存放服务器端返回的图片路径，多个图片以逗号隔开-->
                        <input type="hidden" name="imageUrls">
                    </div>
                    <ul id="J_UploaderQueue" class="grid">

                    </ul>
                </form>

            </div>
            <h4>1) 需要个input标签（type="image-uploader"）</h4>
             <pre class='brush: xml; '>
                <input type="image-uploader" class="g-u" id="J_UploaderBtn" name="Filedata" value="上传图片">
             </pre>
            <table class="table table-bordered table-striped">
                <thead>
                <tr>
                    <th style="width: 200px;">属性</th>
                    <th>描述</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><code>type="image-uploader"</code></td>
                    <td>此属性为了配合Butterfly使用，表明此input为图片上传专用组件</td>
                </tr>
                <tr>
                    <td><code>id="J_UploaderBtn"</code></td>
                    <td>脚本实例化上传组件时使用的钩子</td>
                </tr><tr>
                    <td><code>name="Filedata"</code></td>
                    <td>非常重要，文件上传域name名，服务器端通过name来获取和处理上传数据</td>
                </tr>
                <tr>
                    <td><code>value="上传图片"</code></td>
                    <td>上传按钮上的文案</td>
                </tr>
                </tbody>
            </table>

            <h4>2) 创建一个input（hidden）用于存放服务器端返回的url</h4>
             <pre class='brush: xml; '>
                    <input type="hidden" name="imageUrls">
             </pre>
            <p>给上传按钮input加上<code>urlsInputName="imageUrls"</code>属性，这样当上传成功后图片url会被加入到这个隐藏域中（多个图片路径以逗号隔开）。</p>
            <h4>3) 创建一个空的图片队列</h4>
             <pre class='brush: xml; '>
                    <ul id="J_UploaderQueue" class="grid"></ul>
             </pre>
            <p>给上传按钮input加上<code>queueTarget="#J_UploaderQueue"</code>属性，将上传按钮和上传队列关联起来，当选择完图片后，自动显示图片。</p>
            <h4>4) 配置服务器端参数</h4>

            <p>上传组件必须有服务器端脚本配合，所以需要个服务器端路径。可以使用<code>action</code>属性。</p>

            <p>可能你还需要向服务器post一些参数，比如用户名，商品id等，可以使使用<code>postData='{"author":"明河"}'</code>。</p>

            <h4>5) demo中完整的html结构</h4>
            <pre class='brush: xml; '>
                    <div class="grid">
                        <input class="g-u" id="J_UploaderBtn" name="Filedata" type="image-uploader" value="上传图片" queueTarget="#J_UploaderQueue" action="upload.php" urlsInputName="imageUrls">
                        <!--用来存放服务器端返回的图片路径，多个图片以逗号隔开-->
                        <input type="hidden" name="imageUrls">
                    </div>
                    <ul id="J_UploaderQueue" class="grid">

                    </ul>
            </pre>
            <h4>6) 初始化ImageUploader</h4>

            <p>配置下gallery包路径（为了利用淘宝cdn，可以快速引用butterfly库，所以将代码托管在kissy gallery下）。</p>
            <pre class='brush: js; '>
                var S = KISSY,
                      path = "http://a.tbcdn.cn/s/kissy/";
                KISSY.config({
                    packages:[
                        {
                            name:"gallery",
                            path:path,
                            charset:"utf-8"
                        }
                    ]
                });
            </pre>
            <p>初始化ImageUploader：</p>
            <pre class='brush: js; '>
            KISSY.use('gallery/form/1.3/uploader/imageUploader', function (S, ImageUploader) {
                new ImageUploader('#J_UploaderBtn').render();
            })
            </pre>
            <div class="alert alert-info">
                当实例化ImageUploader时，组件会自动加载主题js和css文件，比如没用<code>theme</code>属性时，加载默认主题<code>theme="imageUploader"</code>，<code>gallery/form/1.3/uploader/themes/imageUploader/index-min.js</code> 和<code>gallery/form/1.3/uploader/themes/imageUploader/style.css</code>。
            </div>
            <h2 id="auth">上传验证控制</h2>
            <div class="bs-docs-example">
                <form action="#" style="font-size:12px;">
                    <div class="grid">
                        <input type="image-uploader" class="g-u" id="J_AuthBtn" name="Filedata" value="上传图片" maxSize="500" max="4" allowExts="png" required >
                    </div>
                    <ul id="J_AuthQueue" class="grid">

                    </ul>
                    <p>组件的验证配置信息：<span class="J_AuthMsg"></span></p>

                    <p><input class="btn btn-primary" id="J_TestRequired" value="验证是否上传了一个文件" type="button"><input class="btn btn-primary" id="J_TestMax" value="验证是否达到最大上传数" type="button"></p>
                </form>
            </div>
            <pre class='brush: xml; '>
<div class="grid">
  <input type="image-uploader" class="g-u" id="J_AuthBtn" name="Filedata" value="上传图片" maxSize="500" max="4" allowExts="png" required >
</div>
<ul id="J_AuthQueue" class="grid">

</ul>
<p>组件的验证配置信息：<span class="J_AuthMsg"></span></p>

<p><input class="btn btn-primary" id="J_TestRequired" value="验证是否上传了一个文件" type="button"><input class="btn btn-primary" id="J_TestMax" value="验证是否达到最大上传数" type="button"></p>
            </pre>
            <pre class='brush: js; '>
var authImageUploader = new ImageUploader('#J_AuthBtn','#J_AuthQueue',{
    action:"upload.php",
    urlsInputName:"authImageUrls"
});
authImageUploader.on('render',function(ev){
    var uploader = ev.uploader;
    var max = uploader.get('max');
    var required = uploader.get('required');
    var allowExts = uploader.get('allowExts');
    var maxSize = uploader.get('maxSize');
    $('.J_AuthMsg').text('max:'+max + ',required:' + required + ',allowExts:' + allowExts + ',maxSize:' + maxSize);

    $('#J_TestRequired').on('click',function(ev){
        var isPass = uploader.testRequired();
        alert(isPass);
    });

    $('#J_TestMax').on('click',function(ev){
        var isPass = uploader.testMax();
        alert(isPass);
    });
});
authImageUploader.render();
            </pre>
            <h2>事件演示</h2>

            <div class="row">
                <div class="span6">
                    <div class="grid">
                        <input class="g-u" id="J_UploaderBtn2" name="Filedata" type="image-uploader" value="上传图片"
                               action="upload.php" urlsInputName="imageUrls2" maxSize="500" max="4">
                        <input type="hidden" name="imageUrls2">
                    </div>
                    <ul id="J_UploaderQueue2" class="grid">

                    </ul>
                </div>
                <div class="span6">
                    <div id="J_Panel" class="event-panel">

                    </div>
                </div>
            </div>
            <h2>接口控制演示</h2>

            <div class="row">
                <div class="span6">
                    <div class="grid">
                        <input class="g-u" id="J_UploaderBtn3" name="Filedata" type="image-uploader" value="上传图片"
                               action="upload.php" urlsInputName="imageUrls3" maxSize="500" max="4">
                        <input type="hidden" name="imageUrls3">
                    </div>
                    <ul id="J_UploaderQueue3" class="grid">

                    </ul>
                </div>
                <div class="span6">

                </div>
            </div>
            <h2>使用其他主题的demo</h2>
            <div class="row">
                <div class="span6">
                    <p>使用<code>refundUploader</code>主题，增加个属性<code>theme="refundUploader"</code>，该主题是从淘宝退款的上传凭证提炼出来的。</p>

                    <script type="text/uploader-restore" id="J_RefundImageRestore">
                        [
                        {"name":"icon_evil.gif",
                        "size":1446,
                        "type":"image/gif",
                        "result":{
                        "status":1,
                        "data":{
                        "name":"icon_evil.gif",
                        "url":"http://tp4.sinaimg.cn/1653905027/50/5601547226/1",
                        "item_id":"42458"
                        }
                        }
                        }
                        ]
                    </script>

                    <div class="grid">
                        <input class="g-u" id="J_RefundUploaderBtn" name="Filedata" type="image-uploader" value="选择要上传的图片"
                               theme="refundUploader" queueTarget="#J_RefundUploaderQueue"
                               action="upload.php" urlsInputName="refundImageUrls" maxSize="500" max="3"
                               restoreHook="#J_RefundImageRestore"
                                >
                        <input type="hidden" name="refundImageUrls">
                    </div>
                    <ul id="J_RefundUploaderQueue" class="grid">

                    </ul>
                </div>
                <div class="span6">

                </div>
            </div>

        </div>
    </div>

</div>
<script>
    var S = KISSY,
    //包路径，实际使用请直接配置为"http://a.tbcdn.cn/s/kissy/"
            path = S.Config.debug && "../../../../../../" || "http://a.tbcdn.cn/s/kissy/";
    S.config({
        packages:[
            {
                name:"gallery",
                path:path,
                charset:"utf-8"
            }
        ]
    });

    var $ = S.Node.all;

    /**
     * 向事件面板添加消息
     * @param evt
     * @param msg
     */
    function addMsg(evt, msg) {
        var $ = S.Node.all;
        var $panel = $("#J_Panel");
        var text = "<p>事件名称：" + evt.type + "，" + msg + "</p>";
        $panel.append(text);
        S.log(text);
    }

    //加载上传组件入口文件
    KISSY.use('gallery/form/1.3/uploader/imageUploader', function (S, ImageUploader) {
        new ImageUploader('#J_JsUploaderBtn','#J_JsUploaderQueue',{
            // 文件域
            name:"Filedata",
            //处理上传的服务器端脚本路径
            action:"upload.php",
            //用于放服务器端返回的url的隐藏域
            urlsInputName:"jsImageUrls"
        }).render();

        new ImageUploader('#J_UploaderBtn').render();


        var authImageUploader = new ImageUploader('#J_AuthBtn','#J_AuthQueue',{
            action:"upload.php",
            urlsInputName:"authImageUrls"
        });
        authImageUploader.on('render',function(ev){
            var uploader = ev.uploader;
            var max = uploader.get('max');
            var required = uploader.get('required');
            var allowExts = uploader.get('allowExts');
            var maxSize = uploader.get('maxSize');
            $('.J_AuthMsg').text('max:'+max + ',required:' + required + ',allowExts:' + allowExts + ',maxSize:' + maxSize);

            $('#J_TestRequired').on('click',function(ev){
                var isPass = uploader.testRequired();
                alert(isPass);
            });

            $('#J_TestMax').on('click',function(ev){
                var isPass = uploader.testMax();
                alert(isPass);
            });
        });
        authImageUploader.render();

        //事件演示demo
        var imageUploader2 = new ImageUploader('#J_UploaderBtn2', '#J_UploaderQueue2');
        imageUploader2.on('render', function (ev) {
            addMsg(ev, '上传组件准备就绪！');
        });
        imageUploader2.on('select', function (ev) {
            var files = ev.files;
            addMsg(ev, '选择了' + files.length + '个文件');
        });
        imageUploader2.on('start', function (ev) {
            var index = ev.index, file = ev.file;
            addMsg(ev, '开始上传,文件名：' + file.name + '，队列索引为：' + index);
        });
        imageUploader2.on('progress', function (ev) {
            var file = ev.file, loaded = ev.loaded, total = ev.total;
            addMsg(ev, '正在上传,文件名：' + file.name + '，大小：' + total + '，已经上传：' + loaded);
        });
        imageUploader2.on('success', function (ev) {
            var index = ev.index, file = ev.file;
            //服务器端返回的结果集
            var result = ev.result;
            addMsg(ev, '上传成功,服务器端返回上传方式：' + result.type);
        });
        imageUploader2.on('complete', function (ev) {
            var index = ev.index, file = ev.file;
            //服务器端返回的结果集
            var result = ev.result;
            addMsg(ev, '上传结束,服务器端返回上传状态：' + result.status);
        });
        imageUploader2.on('error', function (ev) {
            var index = ev.index, file = ev.file;
            //服务器端返回的结果集
            var result = ev.result;
            addMsg(ev, '上传失败,错误消息为：' +result.msg);
        });
        imageUploader2.on('add',function(ev){
            var queue = ev.queue;
            var file = ev.file;
            addMsg(ev, '队列添加文件！文件名为：'+file.name);
        });
        imageUploader2.on('remove',function(ev){
            var queue = ev.queue;
            addMsg(ev, '队列删除文件！文件索引值：'+ev.index);
            alert('队列中的文件数为：'+queue.get('files').length);
        });
        imageUploader2.render();

        var imageUploader3 = new ImageUploader('#J_UploaderBtn3', '#J_UploaderQueue3');
        imageUploader3.render();

        var refundUploader = new ImageUploader('#J_RefundUploaderBtn');
        refundUploader.on('render',function(ev){
            var uploader = ev.uploader;
            uploader.set('filter',function(data){
                data = S.JSON.parse(data);
                //unicode自动转换测试
                data.author = '\u660e\u6cb3';
                return data;
            })
        });
        refundUploader.render();
    })
</script>

<!-- 代码高亮 START  -->
<link href='../../assets/syntaxhighlighter_3.0.83/sh.css' rel='stylesheet' type='text/css'/>
<script type="text/javascript" src="../../assets/syntaxhighlighter_3.0.83/sh.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();</script>
<!-- 代码高亮 END  -->
</body>
</html>

